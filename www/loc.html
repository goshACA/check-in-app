<!DOCTYPE html>

<html>

<head>
    <title>Hotel</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport"
        content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">

    <link rel="stylesheet" href="themes/mytheme.min.css" />
    <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />

    <!-- Include jQuery Mobile stylesheets -->

    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />



    <!-- Include the jQuery library -->
    <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

    <!-- Include the jQuery Mobile library -->
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

</head>

<body>
    <!-- page loc -->
    <div data-role="page" id="ploc">

        <div data-role="header" data-position="fixed">
            <a href="index.html" target="_blank" class="ui-btn ui-corner-all ui-shadow 
    ui-icon-home ui-btn-icon-left">Home</a>
            <h1>location</h1>
        </div>


        <div data-role="main" class="ui-content">
            <div id="map" style="height:700px;">
                
            </div>
        </div>




        <div data-role="footer" data-position="fixed">
            <h4>&copy; Berlin 2021</h4>
        </div>
    </div>

    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript"
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCEVCeB0f_0LShmsPoRvjqzcO_b2pa38ek&sensor=true"></script>

    <script>
        document.addEventListener("deviceready", onDeviceReady, false);
        
        var markerPoints = []
        var markerTitle = []
        var markerNumber = []
        var markerMail = []
        var markerSite = []
        function onDeviceReady() {



            $.ajax({
                type: "GET",
                url: "http://192.168.43.175/config.php",
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                dataType: "text",
                success: function (response) {
                    var res = response.split("Restaurant:");
                    res.forEach(function (element) {
                        var indLat = element.indexOf("Lat:");
                        var indLon = element.indexOf("Lon:");
                        var indNumber = element.indexOf("Number:");
                        var indMail = element.indexOf("Email:");
                        var indSite = element.indexOf("Website:");
                        var addStr = element.substring(0, indLat);
                        var latStr = element.substring(indLat + "Lat:".length + 1, indLon);
                        var lonStr = element.substring(indLon + "Lon:".length);
                        markerPoints.push({ lat: parseFloat(latStr), lng: parseFloat(lonStr) });
                        markerTitle.push(addStr);
                        markerNumber.push(element.substring(indNumber + "Number:".length, indMail));
                        markerMail.push(element.substring(indMail + "Email:".length, indSite));
                        markerSite.push(element.substring(indSite + "Website:".length, element.length));
                    });
                    navigator.geolocation.getCurrentPosition(onMapSuccess, onMapError);
                },
                error: function (error) {
                    console.log("FFF" + error);
                    alert(error);
                }
            });
            navigator.geolocation.getCurrentPosition(onMapSuccess, onMapError);

        }

        var onMapSuccess = function (position) {

            Latitude = position.coords.latitude;
            Longitude = position.coords.longitude;

            getMap(Latitude, Longitude);

        }

       

        function getMap(latitude, longitude) {

            var mapOptions = {
                center: new google.maps.LatLng(0, 0),
                zoom: 1,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };

            map = new google.maps.Map
                (document.getElementById("map"), mapOptions);


            var latLong = new google.maps.LatLng(latitude, longitude);


            var marker = new google.maps.Marker({
                position: latLong
            });




            markerPoints.forEach(function (element) {
                var marker = new google.maps.Marker({
                    position: element,
                    map,
                    title: markerTitle[markerPoints.indexOf(element)],
                });
                var contentString =
                    '<div id="content">' +
                    '<div id="siteNotice">' +
                    "</div>" +
                    '<h3 id="firstHeading" class="firstHeading">Restaurant:</h3>' +
                    '<div id="bodyContent">' +
                    "<p>" + markerTitle[markerPoints.indexOf(element)] + "</p>" +
                    "</div>" +
                    '<h3 id="secondHeading" class="secondHeading">Number:</h3>' +
                    '<div id="bodyContent">' +
                    "<p>" + markerNumber[markerPoints.indexOf(element)] + "</p>" +
                    "</div>" +
                    '<h3 id="thirdHeading" class="thirdHeading">Email:</h3>' +
                    '<div id="bodyContent">' +
                    "<p>" + markerMail[markerPoints.indexOf(element)] + "</p>" +
                    "</div>" +
                    '<h3 id="fourthHeading" class="fourthHeading">Website:</h3>' +
                    '<div id="bodyContent">' +
                    "<p>" + markerSite[markerPoints.indexOf(element)] + "</p>" +
                    "</div>" +
                    "</div>";
                var infowindow = new google.maps.InfoWindow({
                    content: contentString,
                });
                marker.addListener("click", () => {
                    infowindow.open(map, marker);
                });
            });

            marker.setMap(map);
            map.setZoom(15);
            map.setCenter(marker.getPosition());
        }


        function pinCoordinate(element, map) {
            new google.maps.Marker({
                position: element,
                map,
                title: "Hello World!",
            });
        }


        var onMapWatchSuccess = function (position) {

            var updatedLatitude = position.coords.latitude;
            var updatedLongitude = position.coords.longitude;

            if (updatedLatitude != Latitude && updatedLongitude != Longitude) {

                Latitude = updatedLatitude;
                Longitude = updatedLongitude;

                getMap(updatedLatitude, updatedLongitude);
            }
        }

        function onMapError(error) {
            console.log('code: ' + error.code + '\n' +
                'message: ' + error.message + '\n');
        }

        function watchMapPosition() {

            return navigator.geolocation.watchPosition
                (onMapWatchSuccess, onMapError, { enableHighAccuracy: true });
        }
    </script>

</body>

</html>